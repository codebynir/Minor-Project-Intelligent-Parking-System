<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IPS User</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../../static/plugins/fontawesome-free/css/all.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
  <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="../../static/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
  <!-- iCheck -->
  <link rel="stylesheet" href="../../static/plugins/icheck-bootstrap/icheck-bootstrap.min.css">
  <!-- JQVMap -->
  <link rel="stylesheet" href="../../static/plugins/jqvmap/jqvmap.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../../static/dist/css/adminlte.min.css">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="../../static/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="../../static/plugins/daterangepicker/daterangepicker.css">
  <!-- summernote -->
  <link rel="stylesheet" href="../../static/plugins/summernote/summernote-bs4.min.css">

</head>

<body class="hold-transition sidebar-mini layout-fixed">
  <div class="wrapper">

    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-red navbar-light" style="background-color: crimson;">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>

      </ul>

      <!-- Right navbar links -->
      <ul class="navbar-nav ml-auto">
        <!-- Messages Dropdown Menu -->

        <!-- Notifications Dropdown Menu -->

        <li class="nav-item">
          <a class="nav-link" data-widget="fullscreen" href="#" role="button">
            <i class="fas fa-expand-arrows-alt"></i>
          </a>
        </li>

      </ul>
    </nav>
    <!-- /.navbar -->

    <!-- Main Sidebar Container -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
      <!-- Brand Logo -->
      <a href="" class="brand-link">
        <img src="../../static/dist/img/logo.jpg" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
          style="opacity: .8">
        <span class="brand-text font-weight-light">IPS User</span>
      </a>

      <!-- Sidebar -->
      <div class="sidebar">
        <!-- Sidebar user panel (optional) -->
        <div class="user-panel mt-3 pb-3 mb-3 d-flex">
          <div class="image">
            <img src="../../static/dist/img/avatar.png" class="img-square elevation-3" alt="User Image">
          </div>
          <div class="info">
            <a href="#" class="d-block">{{u_name[0][0]}}</a>
          </div>

        </div>

        <!-- Sidebar Menu -->
        <nav class="mt-2">
          <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
            <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
            <li class="nav-item menu-open">
              <a href="{{url_for('user_dashboard', name = name)}}" class="nav-link active">
                <i class="nav-icon fas fa-tachometer-alt"></i>
                <p>
                  Dashboard
                </p>
              </a>
            </li>
            <li class="nav-item">
              <a href="{{url_for('bookingrequest', name = name)}}" class="nav-link">
                <i class="nav-icon fas fa-book"></i>
                <p>Booking</p>
              </a>
            </li>
            <!-- <li class="nav-item">
              <a href="" class="nav-link">
                <i class="nav-icon fas fa-book"></i>
                <p>Payment History</p>
              </a>
            </li> -->
            <li class="nav-item">
              <a href="{{url_for('home_page')}}" class="nav-link">
                <i class="nav-icon fas fa-power-off"></i>
                <p>
                  Logout
                </p>
              </a>
            </li>

          </ul>
        </nav>
        <!-- /.sidebar-menu -->
      </div>
      <!-- /.sidebar -->
    </aside>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <div class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1 class="m-0">Dashboard</h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-right">
                <li class="breadcrumb-item"><a href="{{url_for('home_page')}}">Home</a></li>
                <li class="breadcrumb-item active">Dashboard</li>
              </ol>
            </div><!-- /.col -->
          </div><!-- /.row -->
        </div><!-- /.container-fluid -->
      </div>
      <!-- /.content-header -->

      <!-- Changes section ------------------------------>
      <!-- Main content -->
      <section class="content" style="position: relative;">
        <div class="container-fluid">
          <!-- Small boxes (Stat box)  -->
          <!-- Drop down menu  -->
          <div class="wrapper-dropdown">

            <div class="select-btn">
              <span>Select Company</span>
              <i class="uil uil-angle-down"></i>
            </div>
            <div class="content-dropdown" style="position: fixed;z-index:3">
              <div class="search">
                <i class="uil uil-search"></i>
                <input spellcheck="false" type="text" placeholder="Search">
              </div>
              <ul class="options"></ul>
            </div>

          </div>

          <!-- <!- Main row -- -->
          <div class="row">
            <!-- /.card-header -->
            <div class="card-body">

              <table id="example1" class="table table-bordered table-striped">
                <thead>
                  <tr>
                    <th>Company Name</th>
                    <th>Company Location</th>
                    <th>Parking Block No.</th>
                    <th>Total Parking Slots</th>
                    <th>Available Parking Slots</th>
                  </tr>
                </thead>
                <tbody id = 'table_content'>
                  {% if data == '' %}
                  <tr>
                    <td colspan="5" style="text-align: center;">Select Company to see Parking Slot Information</td>
                  </tr>
                  {% else %}
                  {% for row in data %}
                  <tr>
                    <td>{{row[0]}}</td>
                    <td>{{row[1]}}</td>
                    <td>{{row[2]}}</td>
                    <td>{{row[3]}}</td>
                    <td>{{row[4]}}</td>
                  </tr>
                  {% endfor %}
                  {% endif %}
                </tbody>

              </table>

            </div>
            <!-- /.card-body -->

          </div>
          <!-- <!- /.row (main row) -- -->
        </div><!--- /.container-fluid -->
      </section>
      <!-- <!- /.content -- -->
    </div>
    <!-- /.content-wrapper -->

    <!-- End Changes ---------------------------------->
    <footer class="main-footer">
      <strong><a href="{{url_for('home_page')}}">Intelligent Parking System</a></strong>
      <!-- All rights reserved.
    <div class="float-right d-none d-sm-inline-block">
      <b>Footer</b>
    </div> -->
    </footer>

    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
      <!-- Control sidebar content goes here -->
    </aside>
    <!-- /.control-sidebar -->
  </div>
  <!-- ./wrapper -->

  <!-- jQuery -->
  <script src="../../static/plugins/jquery/jquery.min.js"></script>
  <!-- jQuery UI 1.11.4 -->
  <script src="../../static/plugins/jquery-ui/jquery-ui.min.js"></script>
  <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
  <script>
    $.widget.bridge('uibutton', $.ui.button)
  </script>
  <!-- Bootstrap 4 -->
  <script src="../../static/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <!-- ChartJS -->
  <script src="../../static/plugins/chart.js/Chart.min.js"></script>
  <!-- Sparkline -->
  <script src="../../static/plugins/sparklines/sparkline.js"></script>
  <!-- JQVMap -->
  <script src="../../static/plugins/jqvmap/jquery.vmap.min.js"></script>
  <script src="../../static/plugins/jqvmap/maps/jquery.vmap.usa.js"></script>
  <!-- jQuery Knob Chart -->
  <script src="../../static/plugins/jquery-knob/jquery.knob.min.js"></script>
  <!-- daterangepicker -->
  <script src="../../static/plugins/moment/moment.min.js"></script>
  <script src="../../static/plugins/daterangepicker/daterangepicker.js"></script>
  <!-- Tempusdominus Bootstrap 4 -->
  <script src="../../static/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
  <!-- Summernote -->
  <script src="../../static/plugins/summernote/summernote-bs4.min.js"></script>
  <!-- overlayScrollbars -->
  <script src="../../static/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
  <!-- AdminLTE App -->
  <script src="../../static/dist/js/adminlte.js"></script>
  <!-- AdminLTE for demo purposes -->
  <script src="../../static/dist/js/demo.js"></script>
  <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
  <script src="../../static/dist/js/pages/dashboard.js"></script>
</body>



<style>
  /* css for drop down menu */
  ::selection {
    color: #fff;
    background: #4285f4;
  }

  .wrapper-dropdown {
    width: 370px;
    margin: 8px auto 0;
  }

  .select-btn,
  li {
    display: flex;
    align-items: center;
    cursor: pointer;
  }

  .select-btn {
    height: 65px;
    padding: 0 20px;
    font-size: 22px;
    background: #fff;
    border-radius: 7px;
    justify-content: space-between;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  }

  .select-btn i {
    font-size: 31px;
    transition: transform 0.3s linear;
  }

  .wrapper-dropdown.active .select-btn i {
    transform: rotate(-180deg);
  }

  .content-dropdown {
    display: none;
    padding: 20px;
    margin-top: 15px;
    background: #fff;
    border-radius: 7px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  }

  .wrapper-dropdown.active .content-dropdown {
    display: block;
  }

  .content-dropdown .search {
    position: relative;
  }

  .search i {
    top: 50%;
    left: 15px;
    color: #999;
    font-size: 20px;
    pointer-events: none;
    transform: translateY(-50%);
    position: absolute;
  }

  .search input {
    height: 50px;
    width: 100%;
    outline: none;
    font-size: 17px;
    border-radius: 5px;
    padding: 0 20px 0 43px;
    border: 1px solid #B3B3B3;
  }

  .search input:focus {
    padding-left: 42px;
    border: 2px solid #4285f4;
  }

  .search input::placeholder {
    color: #bfbfbf;
  }

  .content-dropdown .options {
    margin-top: 10px;
    max-height: 250px;
    overflow-y: auto;
    padding-right: 7px;
  }

  .options::-webkit-scrollbar {
    width: 7px;
  }

  .options::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 25px;
  }

  .options::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 25px;
  }

  .options::-webkit-scrollbar-thumb:hover {
    background: #b3b3b3;
  }

  .options li {
    height: 50px;
    padding: 0 13px;
    font-size: 21px;
  }

  .options li:hover,
  li.selected {
    border-radius: 5px;
    background: #f2f2f2;
  }
</style>

{% block javascript %}
<script>
  /* js for drop down menu */
  const wrapper = document.querySelector(".wrapper-dropdown"),
    selectBtn = wrapper.querySelector(".select-btn"),
    searchInp = wrapper.querySelector("input"),
    options = wrapper.querySelector(".options");

  
  let companies = JSON.parse('{{companies_name | tojson}}');

  myKeysArr = []
  companies.forEach(c => {
    myKeysArr.push(c.toString());
  });

  companies = myKeysArr

  function addCompany(selectedCompany) {
    options.innerHTML = "";
    companies.forEach(company => {
      let isSelected = company == selectedCompany ? "selected" : "";
      let li = `<li onclick="updateName(this)" class="${isSelected}">${company}</li>`;
      options.insertAdjacentHTML("beforeend", li);
    });
  }
  addCompany();

  function updateName(selectedLi) {
    searchInp.value = "";
    const company = selectedLi.innerText;
    const name = "{{ name }}";  // Ensure this is properly populated

    // Send POST request with selected company and user name
    fetch('/user/dashboard/update', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            company: company,
            name: name
        }),
    })
    .then(response => response.json())
    .then(data => {
        // Handle the JSON data returned from the server
        if (data.error) {
            // Handle any errors
            console.error(data.error);
        } else {
            updateTable(data);
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });

    // Update dropdown
    addCompany(selectedLi.innerText);
    wrapper.classList.remove("active");
    selectBtn.firstElementChild.innerText = selectedLi.innerText;
    document.getElementById('table_content').innerHTML = '<tr> <td colspan="5" style="text-align:center; color:blue; font-size:20px"> Loading... </td> </tr>';
}

function updateTable(data) {
    const tableContent = document.getElementById('table_content');
    tableContent.innerHTML = ''; // Clear existing content

    data.data.forEach(row => {
        const tr = document.createElement('tr');
        row.forEach(cell => {
            const td = document.createElement('td');
            td.innerText = cell;
            tr.appendChild(td);
        });
        tableContent.appendChild(tr);
    });
}

  searchInp.addEventListener("keyup", () => {
    let arr = [];
    let searchWord = searchInp.value.toLowerCase();
    arr = companies.filter(data => {
      return data.toLowerCase().startsWith(searchWord);
    }).map(data => {
      let isSelected = data == selectBtn.firstElementChild.innerText ? "selected" : "";
      return `<li onclick="updateName(this)" class="${isSelected}">${data}</li>`;
    }).join("");
    options.innerHTML = arr ? arr : `<p style="margin-top: 10px;">Oops! Data not found</p>`;
  });

  selectBtn.addEventListener("click", () => wrapper.classList.toggle("active"));
</script>
{% endblock %}

</html>
